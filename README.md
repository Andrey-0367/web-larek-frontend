# Проектная работа "Веб-ларек"
https://github.com/Andrey-0367/web-larek-frontend.git

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Продукт

```
export interface ICard {
    _id: string;
    description: string;
    image: string;
    title: string;
    category: string;
    price: number;
}
```
Заказ
```
export interface IOrder extends IOrderContent {
    payment: string;
    email: string;
    phone: string;
    address: string;
    setIOrderInfo(orderData: IOrder): void;
    checkOrderAddressValidation(data: Record<keyof TOrderBaseAddressInfo, string>): boolean;
    checkOrderPhoneValidation(data: Record<keyof TOrderBasePhoneInfo, string>): boolean;
}
```

Интерфейс для модели данных товара

```
export interface ICardsData {
    cards: ICard[];
    preview: string | null;
    getCard(cardId: string): ICard;
}
```

Данные покупателя в форме ввода адреса и выбора формы оплаты

```
export type TOrderBaseAddressInfo = Pick<IOrder, 'payment' | 'address'>;
```

Данные покупателя в форме ввода электронной почты и телефона

```
export type TOrderBasePhoneInfo = Pick<IOrder, 'email' | 'phone'>;
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:
- слой представления, отвечает за отображение данных на странице,
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Конструктор:
- constructor(baseUrl: string, options: RequestInit = {}) - принимает базовый URL и глобальные опции для всех запросов(опционально).
Методы:
- get(url: string): Promise<object>` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- post(url: string, data: object, method: ApiPostMethods = 'POST'): Promise<object> - принимает объект с данными, которые будут переданы в JSON в теле запроса,
    и отправляет эти данные на ендпоинт переданный как параметр при вызове метода.
    По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.
    uri(string): uri — это ресурс для запроса, а data (object)это объект, в котором данные для отправки в теле запроса.
- handleResponse(response: Response): Promise<object> - обработчик ответа от сервера, он возвращает промис.
    С помощью этого промиса разрешен результат в формате JSON в случае получения ответа от сервера.
    В случае ошибки выводит её название или статус.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
- constructor()
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

### Слой данных

#### Класс CardsData
Класс отвечает за хранение и логику работы с данными продуктов.\
Конструктор класса принимает инстант брокера событий\
- constructor(events: EventEmitter)
В полях класса хранятся следующие данные:
- _cards: ICard[] - массив объектов карточек продуктов
- _preview: string | null - id карточки продукта, выбранного для просмотра в модальном окне
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при выборе продукта.

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- getCard(cardId: string): ICard - возвращает продукт по его id
- а так-же геттеры для получения данных из полей класса

#### Класс OrderData
Класс отвечает за хранение и логику работы с данными текущего покупателя.\
Конструктор класса принимает инстант брокера событий\
- constructor(events: EventEmitter)
В полях класса хранятся следующие данные:
- payment: string - способ оплаты
- email: string - Электронная почта
- phone: number - телефон
- address: string - адрес доставки
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- setOrderInfo(OrderData: IUser): void - сохраняет данные покупателя в классе
- checkValidation(data: Record<keyof TOrderPublicInfo, string>): boolean - проверяет объект с данными покупателя на валидность

#### Класс BasketData
Класс отвечает за хранение и логику работы с данными покупок
Конструктор класса принимает инстант брокера событий\
- constructor(events: EventEmitter)
В полях класса хранятся следующие данные:
- total: number - сумма покупки
- items: ICard[] - список покупок
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- addCard(card: ICard): void - добавляет один продукт в начало массива
- deleteCard(cardId: string): void - удаляет продукт из массива. 
- getCard(cardId: string): ICard - возвращает продукт по его id
- а так-же сеттеры и геттеры для сохранения и получения данных из полей класса

### Классы представления

#### Класс Component
Отвечает за отображение внутри контейнера (ДОМ - элемент) передаваемых в них данных.
- constructor(selector: string, events: IEvents)- Конструктор принимает селектор, по которому в разметке страницы будет идентифицировано модальное окно и
  экземпляр класса EventEmitter для возможности инициации событий.
  Поля класса:
- events: IEvents - брокер событий
Методы класса:
- render(container: HTMLElement): void - создает элемент из шаблона и вставляет его в контейнер.

#### Класс Modal
Расширяет класс Component. Реализует модальное окно. Предоставляет методы 'open' и 'close' для управления отображениями модального окна.
Устанавливает слушатели на клик в оверлей и кнопку - крестик для закрытия попапа.
Поля класса:
- modal: HTMLElement - элемент модального окна

#### Класс ModalWithForm
Расширяет класс Modal. Предназначен для реализации модального окна с формой, содержащей поля ввода. При "сабмите"
инициирует событие, передавая в него объект с данными из полей ввода формы. Предоставляет методы для отображения ошибок и 
управления активностью кнопки сохранения.
 
Поля класса:
- submitButton: HTMLButtonElement - кнопка подтверждения
- _form: HTMLFormElement - элемент формы
- formName: string - значение атрибута 'name' формы
- inputs: NodeListOf<HTMLInputElement> - коллекция всех полей ввода формы
- errors: Record<string, HTMLElement> - объект, хранящий все элементы для вывода ошибок под полями формы с привязкой к атрибуту "name" инпутов.
Методы:
- setValid(isValid: boolean): void - изменяет активность кнопки подтверждения
- setInputValues(data: Record<string, string>): void - принимает объект с данными для заполнения полей формы
- setError(data: {field: string, value: string, validInformation: string }): void - принимает объект с данными для отображения
или сокрытия текста ошибок под полями ввода
- showInputError(field: string, errorMessage: string): void - отображает полученный текст ошибки под указанным полем ввода
- hideInputError(field: string): void - очищает текст ошибки под указанным полем ввода
- close(): void - расширяет родительский метод дополнительно при закрытии очищая поля формы и деактивируя кнопку сохранения
- get form: HTMLElement - геттер для получения элемента формы

#### Класс ModalWithBasket
Расширяет класс Modal. Предназначен для реализации модального окна с корзиной выбранных продуктов. При открытии модального окна
получает список выбранных продуктов и их общую стоимость.

Поля класса:
- submitButton: HTMLButtonElement - кнопка подтверждения
Методы:
- open(data: IBasketData): void - расширяет родительский метод, принимая массив выбранных продуктов и их общую стоимость
- close(): void - расширяет родительский метод, выполняя дополнительную очистку атрибутов модального окна
- deleteCard(cardId: string): void - метод для удаления продукта из корзины

#### Класс ModalWithPlaced
Расширяет класс Modal. Предназначен для реализации модального окна удачного оформления заказа
- open(): void
- close(): void 

#### Класс Card
Расширяет класс Component. Отвечает за отображение карточки продукта, задавая в карточке данные названия, изображения, категории, описания и стоимости.
Класс используется для отображения карточек продуктов на странице сайта. В конструктор класса передаётся DOM элемент темплэйта,
что позволяет формировать карточки разных вариантов верстки. В классе устанавливаются слушатели на интерактивные элементы.
Поля класса содержат элементы разметки элементов карточки.
Методы:
- setData(cardData: ICard): void - заполняет атрибуты элементов карточки данными
- геттер id возвращает уникальный id карточки

#### Класс CardContainer
Расширяет класс Component. Отвечает за отображение блока с карточками на странице. Предоставляет метод:
'addCard(cardElement: HTMLElement)' для добавления карточек на страницу и сеттер для полного обновления содержимого.
В конструктор принимается контейнер, в котором размещаются карточки.
- constructor(selector: string, events: IEvents, container: HTMLElement)

### Слой Коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\
*События изменения данных (генерируются классами моделями данных)*
- `order:changed` - изменение данных заказа
- `cards:changed` - изменение массива карточек
- `card:selected` - изменение открываемой в модальном окне карточки
- `bascet:previewClear` - необходима очистка данных выбранной для показа в модальном окне заказа

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*
- `orderEditAdres:open` - открытие модального окна с формой ввода способа оплаты и адреса доставки
- `orderEditPhone:open` - открытие модального окна с формой ввода email и телефона
- `bascet:open` - открытие модального окна корзины заказа
- `card:select` - выбор карточки для отображения в модальном окне
- `order:input` - изменение данных в форме с данными заказа
- `order:submit` - сохранение данных заказа в модальном окне

- `card-preview:submit` - событие, генерируемое при добавлении карточки в корзину
- `remove-card:submit` - событие, генерируемое при нажатии на удаление карточки из корзины заказа
- `order:validation` - событие, сообщающее о необходимости валидации формы заказа













