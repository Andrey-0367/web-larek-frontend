# Проектная работа "Веб-ларек"
https://github.com/Andrey-0367/web-larek-frontend.git

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Продукт

```
export interface IItem {
    title: string;
    description: string;
    image: string;
    category: CardCategory;
    price: number;
    id: string;
}
```
Заказ
```
export interface IOrder extends IOrderForm {
    items: string[];
    total: number
}

export interface IOrderResult {
    id: string;
    total: number
}
```

Интерфейс для модели данных товара

```
export interface IAppState {
    catalog: IItem[];
    basket: IBasketItem[];
    preview: string | null;
    order: IOrder | null;
    contact: IOrder | null;
}
```

Данные покупателя в форме ввода 

```
export interface IOrderForm {
    payment: string;
    address: string;
    email: string;
    phone: string;
}
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:
- слой представления, отвечает за отображение данных на странице,
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Конструктор:
- constructor(baseUrl: string, options: RequestInit = {}) - принимает базовый URL и глобальные опции для всех запросов(опционально).
Методы:
- get(url: string): Promise<object>` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- post(url: string, data: object, method: ApiPostMethods = 'POST'): Promise<object> - принимает объект с данными, которые будут переданы в JSON в теле запроса,
    и отправляет эти данные на ендпоинт переданный как параметр при вызове метода.
    По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.
    uri(string): uri — это ресурс для запроса, а data (object)это объект, в котором данные для отправки в теле запроса.
- handleResponse(response: Response): Promise<object> - обработчик ответа от сервера, он возвращает промис.
    С помощью этого промиса разрешен результат в формате JSON в случае получения ответа от сервера.
    В случае ошибки выводит её название или статус.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
- constructor()
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

### Слой данных

#### Класс AppState
Класс отвечает за хранение и логику работы с данными продуктов.\
Конструктор класса принимает инстант брокера событий\
- constructor(data: Partial<T>, protected events: IEvents) 

В полях класса хранятся следующие данные:
- basketProducts: IItem[] = []; - массив объектов карточек корзины
- catalog: IItem[]; - массив объектов карточек продуктов
- order: IOrder; - заказ и данные текущего покупателя
- _preview: string | null - id карточки продукта, выбранного для просмотра в модальном окне
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при выборе продукта.

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- addItem(item: IItem): добавляет продукт в корзину
- deleteItem(cardId: string): удаляет продукт из корзины
- setCatalog(items: IItem[]): возвращает каталог продуктов
- setPreview(item: IItem): возвращает продукт по его id
- getTotal(): общая сумма заказа
- getBasketProducts(): список продуктов в корзине
- setOrderField(field: keyof IOrderForm, value: string): обработка форм
- validateOrder(data: string): валидация форм
- а так-же геттеры для получения данных из полей класса

### Классы представления

#### Класс Component
Отвечает за отображение внутри контейнера (ДОМ - элемент) передаваемых в них данных.
- constructor(selector: string, events: IEvents)- Конструктор принимает селектор, по которому в разметке страницы будет идентифицировано модальное окно и
  экземпляр класса EventEmitter для возможности инициации событий.
  Поля класса:
- events: IEvents - брокер событий
Методы класса:
- render(container: HTMLElement): void - создает элемент из шаблона и вставляет его в контейнер.

#### Класс Modal
Расширяет класс Component. Реализует модальное окно. Предоставляет методы 'open' и 'close' для управления отображениями модального окна.
Устанавливает слушатели на клик в оверлей и кнопку - крестик для закрытия попапа.
Поля класса:
- modal: HTMLElement - элемент модального окна

#### Класс Card<T>
Расширяет класс Component. Отвечает за отображение карточки продукта, задавая в карточке данные названия, изображения, категории, описания и стоимости.
Класс используется для отображения карточек продуктов на странице сайта. В конструктор класса передаётся DOM элемент темплэйта,
что позволяет формировать карточки разных вариантов верстки. В классе устанавливаются слушатели на интерактивные элементы. Дженерик позволяет выбрать категорию.
Поля класса содержат элементы разметки элементов карточки.
Методы:
- get title(): string
- set title(value: string)
- set price(value: number)
- set description(value: string)
- set index(value: number)
- get id(): string
- set id(value: string)

#### Класс CatalogItem
Расширяет класс Card. Отвечает за отображение изображения и категории продукта.
constructor(container: HTMLElement, actions?: ICardActions)
Поля класса содержат элементы разметки элементов карточки.
Методы:
- set category({category}: CatalogItemCategory): определяет категорию продукта
- set image(value: string): определяет изображение

### Слой Коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\
*События изменения данных (генерируются классами моделями данных)*
- `order:changed` - изменение данных заказа
- `items:changed` - изменение массива карточек
- `card:selected` - изменение открываемой в модальном окне карточки

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*
- `order:open` - открытие модального окна с формой ввода способа оплаты и адреса доставки
- `order:submit` - открытие модального окна с формой ввода email и телефона
- `basket:open` - открытие модального окна корзины заказа
- `card:select` - выбор карточки для отображения в модальном окне
- `/^order\..*:change/` - изменение данных в форме с данными заказа


- `basket:select` - событие, генерируемое при добавлении карточки в корзину
- `card:delete` - событие, генерируемое при нажатии на удаление карточки из корзины заказа
- `formErrors:order` - событие, сообщающее о необходимости валидации формы заказа













